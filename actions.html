<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CaptainHook Documentation</title>

  <link rel="icon" type="image/png" href="gfx/favicon.png">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/layout.css" rel="stylesheet">
  <link href="css/atom-one-dark.css" rel="stylesheet">

  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/captainhookphp/captainhook">
        <div class="logo-plus-title"><img src="gfx/captainhook.png" alt="CaptainHook" width="55" /> Captainhook</div>
      </a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="index.html">Home</a></li>
        <li><a href="install.html">Install</a></li>
        <li class="active"><a href="configure.html">Configure</a></li>
        <li><a href="hooks.html">Hooks</a></li>
        <li><a href="extend.html">Extend</a></li>
        <li><a href="https://shop.spreadshirt.de/captainhookphp/">Merch</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container theme-showcase" role="main">

  <h1>Actions</h1>
  <p>Here's a list of all <em>CaptainHook's</em> built-in <em>Actions</em>.</p>

  <ul>
    <li><a href="#msg-regex">Commit message Validation with regex</a></li>
    <li><a href="#msg-rules">Commit message Validation with rules</a></li>
    <li><a href="#msg-issue-key">Inject issue key from branch name</a></li>
    <li><a href="#msg-file-write">Write invalid commit message to a file</a></li>
    <li><a href="#msg-file-read">Load commit message from file</a></li>
    <li><a href="#check-lock-file">Composer lock file checks</a></li>
    <li><a href="#linting">PHP syntax check</a></li>
    <li><a href="#test-coverage">Enforce PHPUnit test coverage</a></li>
    <li><a href="#notify">Git commit message notifications</a></li>
    <li><a href="#file-size">Check file size</a></li>
    <li><a href="#file-empty">Prevent committing any content to files</a></li>
    <li><a href="#file-not-empty">Prevent committing empty files</a></li>
    <li><a href="#file-does-not-contain">Prevent committing specific content to files</a></li>
    <li><a href="#block-secrets">Block secrets of any kind from the repository</a></li>
    <li><a href="#file-exists">Ensure a files exists</a></li>
    <li><a href="#branch-naming">Enforce branch naming</a></li>
    <li><a href="#branch-fixup">Block pushing of squash or fixup commits</a></li>
  </ul>

  <h2>Actions</h2>

  <h3>Commit-Message validation</h3>

  <h4 id="msg-beams">Enforce Chris Beams commit message rules</h4>
  <p>
    Make sure your commit message complies to the following rules.
  </p>
  <ul>
    <li>Subject line starts with an upper-case character</li>
    <li>Subject line doesn't exceed 50 characters</li>
    <li>Subject line doesn't end with a period</li>
    <li>Subject line and body are separated by a blank line</li>
    <li>Body lines don't exceed 72 characters</li>
    <li>Use imperative mood</li>
  </ul>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Message\Action\Beams",
  "options": []
}</code></pre>

  <h4 id="msg-regex">Commit message regex validation</h4>
  <p>
    Use a regex to validate your commit messages.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Message\Action\Regex",
  "options": {
    "regex": "#.*#i",
    "error": "No match for: %s",
    "success": "Found match: %s"
  }
}</code></pre>
  Options "error" and "success" are optional.

  <h4 id="msg-rules">Define rules for your commit messages</h4>
  <p>
    Use <em>CaptainHooks</em> built in rules or write <a href="extend.html">your own</a> ones.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Message\Action\Rules",
  "options": [
    "\CaptainHook\App\Hook\Message\Rule\MsgNotEmpty"
  ]
}</code></pre>

  <h4 id="msg-file-write">Write invalid commit message to file</h4>
  <p>
    Writes the invalid commit message to a file. This way it can be loaded for the next commit attempt, and
    you don't have to type the whole message again. Instead, you can just fix the errors and proceed.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Message\Action\CacheOnFail",
  "options": {
    "file": ".git/CH_MSG.temp"
  }
}</code></pre>

  <h3>Commit-Message preparation</h3>

  <div class="alert alert-warning">
    Be aware that <em>prepare-commit-msg</em> hooks should support two scenarios:
    <ol>
      <li>
        Commit without providing a message<br>
        Then the editor will load with your prepared commit message to edit.
      </li>
      <li>
        Commit with providing a message<br>
        This way the commit message will be whatever you prepare. So you have to use the provided message
        and combine it with your "preparation" otherwise you will just overwrite the message.
      </li>
    </ol>
  </div>

  <h4 id="msg-issue-key">Inject issue key into your commit message</h4>
  <p>
    Extracts an issue key from the current branch name and appends or prepends it to your commit messages
    subject or body. If the commit message already contains the key nothing is added. If you set the <em>force</em>
    option to <em>true</em> it will fail if no issue key can be extracted.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Message\Action\InjectIssueKeyFromBranch",
  "options": {
    "regex": "#([A-Z]+\\-[0-9]+)#i",
    "into": "body",
    "mode": "append",
    "prefix": "\\n\\nIssue: ",
    "force": false
  }
}</code></pre>

  <h4 id="msg-file-read">Load commit message from file</h4>
  <p>
    Load a commit message from a file for example if you wrote an invalid commit message to a file in a
    previous commit attempt.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Message\Action\LoadFromFile",
  "options": {
    "file": ".git/CH_MSG.temp"
  }
}</code></pre>

  <h3>Pre-Commit / Pre-Push</h3>

  <h4 id="check-lock-file">Composer lock file check</h4>
  <p>
    Make sure your <em>composer.lock</em> file is up to date.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Composer\Action\CheckLockFile",
  "options": []
}</code></pre>

  <h4 id="linting">Lint all changed PHP files</h4>
  <p>
    Make sure your PHP code doesn't contain any syntax errors.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\PHP\Action\Linting",
  "options": []
}</code></pre>

  <h4 id="test-coverage">Monitor your unit test code coverage</h4>
  <p>
    Make sure you code coverage doesn't decrease beyond a given percent value.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\PHP\Action\TestCoverage",
  "options": {
    "minCoverage": 90,
    "cloverXml": "build/logs/clover.xml"
  }
}</code></pre>

  <h4 id="file-size">Check if files are too big</h4>
  <p>
    Make sure you do not commit files that are bigger than a configured size limit.<br>
    Use 'B', 'K' or 'M' as size indication.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\File\Action\MaxSize",
  "options": {
    "maxSize": "5M"
  }
}</code></pre>

  <h4 id="file-empty">Check if a file is empty or does not exist</h4>
  <p>
    Make sure you do not commit if there is any file of a configured list that is not empty.
    The following configuration makes sure you will not commit log files with contents to the repository.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\File\Action\IsEmpty",
  "options": {
    "files": [
      ".env",
      "logs/event.log",
      "logs/app/*.log"
    ]
  }
}</code></pre>

  <h4 id="file-not-empty">Check if a file is not empty</h4>
  <p>
    Make sure you do not commit empty files to the repository.
    With this configuration you can make sure that README files are not committed without any contents.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\File\Action\IsNotEmpty",
  "options": {
    "files": [
      "README.md",
      "src/Modules/**/README.md"
    ]
  }
}</code></pre>

  <h4 id="file-does-not-contain">Check if a file does not contain certain text</h4>
  <p>
    Make sure you do not commit specific contents to a list of file types.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\File\Action\DoesNotContainRegex",
  "options": {
    "regex": "#print_r|var_dump#i"
    "regexName": "debug output"
    "fileExtensions": [
      "inc",
      "php"
    ]
  }
}</code></pre>

  <h4 id="block-secrets">Block secrets from being stored in the repository</h4>
  <p>
    Make sure you are not committing passwords or api tokens to the repository.
    You can configure existing regex supplier oder define your own ones.
    If it detects something wrongfully you can define an allow list.
    If you configure an `entropyThreshold` greater than zero. The Cap'n will do
    some entropy calculations to detect passwords.
    <em>blockDefault</em> to <em>false</em>.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Diff\Action\BlockSecrets",
  "options": {
    "entropyThreshold": 3.7,
    "suppliers": [
      "\\CaptainHook\\Secrets\\Regex\\Supplier\\Aws",
      "\\CaptainHook\\Secrets\\Regex\\Supplier\\Github",
      "\\CaptainHook\\Secrets\\Regex\\Supplier\\Stripe",
      "\\CaptainHook\\Secrets\\Regex\\Supplier\\Google",
      "\\CaptainHook\\Secrets\\Regex\\Supplier\\Password"
    ],
    "blocked": ["#password\": \"[\S]+\"#i"],
    "allowed": ["#my-dummy-token#", "#root#"]
  }
}</code></pre>

  <h4 id="file-exists">Ensure a file exists</h4>
  <p>
    Make sure you are only allowed to push if configured files exist in the repository.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\File\Action\Exists",
  "options": {
    "files": [
      "tests/**/*Tests.php",
      "README.md"
    ]
  }
}</code></pre>

  <h4 id="branch-naming">Enforce branch naming rules</h4>
  <p>
    Make sure branch names match a configured regex.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Branch\Action\EnsureNaming",
  "options": {
    "regex": "#master|integration|feature/[a-z]+-[0-9]+#"
  }
}</code></pre>

  <h4 id="branch-fixup">Block pushing of !fixup or !squash commits</h4>
  <p>
    Preparing !fixup or !squash commits for smooth rebasing is very handy. But you may not want to push those commits
    to the main branch. If you don't provide any protected branches push fixup and squash commits is generally
    prohibited.
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Branch\Action\BlockFixupAndSquashCommits",
  "options": {
    "protectedBranches": ["main", "master"]
  }
}</code></pre>

  <h3>Post-Merge, Post-Rewrite, Post-Checkout</h3>

  <h4 id="notify">Display notifications if you merge or checkout commits with notifications</h4>
  <p>
    Trigger notifications with git commit messages. Use <em>git-notify:</em> in your commit message to display
    notifications after merge, rebase or checkout.<br>
    Inspired by: <a href="https://github.com/jevakallio/git-notify">git-notify from Jani Eväkallio</a>
  <pre>
Update dev tooling

git-notify: WARNING
Please update your dev tooling</pre>
  </p>
  <pre><code class="javascript">{
  "action": "\CaptainHook\App\Hook\Notify\Action\Notify",
  "options": {
    "prefix": "git-notify:"
  }
}</code></pre>

</div>


  <footer class="footer">
    <div class="container">
      <p>
        Found a typo or a bug?
        Please open an <a href="https://github.com/captainhookphp/captainhook/issues">issue</a>
        or pull request for the <em>gh-pages</em>
        branch of <a href="https://github.com/captainhookphp/captainhook/tree/gh-pages">CaptainHook</a>
      </p>
      <p>
        &copy; <a href="https://github.com/sebastianfeldmann">Sebastian Feldmann</a>
      </p>
    </div>
  </footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
